<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Week 5:  Maximum Likelihood. &#8211; Laurent's Research Page</title>
<meta name="description" content="Week 5:  Maximum Likelihood.">
<meta name="keywords" content="IE15, teaching, week3">



<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Week 5:  Maximum Likelihood.">
<meta property="og:description" content="Week 5:  Maximum Likelihood.">
<meta property="og:url" content="/ie15/IE15-W5">
<meta property="og:site_name" content="Laurent's Research Page">





<link rel="canonical" href="/ie15/IE15-W5">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Laurent's Research Page Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.min.css">
<!-- Webfonts -->
<script src="//use.edgefonts.net/source-sans-pro:n2,i2,n3,i3,n4,i4,n6,i6,n7,i7,n9,i9;source-code-pro:n4,n7;volkhov.js"></script>

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body id="post" itemscope itemtype="http://schema.org/WebPage">

<div class="navigation-wrapper">
	<nav role="navigation" id="site-nav" class="animated drop" itemscope itemtype="http://schema.org/SiteNavigationElement">
	    <ul>
	        
			<li>
				
					<a href="/papers">Papers</a>
				 
			</li>
	        
			<li>
				
					<a href="/code">Code</a>
				 
			</li>
	        
			<li>
				
					<a href="/teaching">Teaching</a>
				 
			</li>
	        
			<li>
				
					<a href="/cv">Curriculum Vitae</a>
				 
			</li>
	        
			<li>
				
					<a href="/">Home</a>
				 
			</li>
	        
	        <li><a href="/feed.xml" title="Atom/RSS feed"><i class="icon-rss"></i> Feed</a></li>
	        <li class="dosearch"><i class="icon-search"></i> Search</li>
	    </ul>
	</nav>
</div><!-- /.navigation-wrapper -->

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->

<div class="search-wrapper">
	<div class="search-form">
		<input type="text" class="search-field" placeholder="Search...">
		<i class="icon-remove-sign icon-2x"></i>
		<ul class="search-results post-list"></ul><!-- /.search-results -->
	</div><!-- /.search-form -->
</div><!-- ./search-wrapper -->

<header class="masthead" itemscope itemtype="http://schema.org/Organization">
</header><!-- /.masthead -->


<div id="main" role="main" itemprop="mainContentOfPage" itemscope itemtype="http://schema.org/Blog">
  <article class="hentry" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="entry-wrapper">
      <header class="entry-header">
        <span class="entry-tags"><a href="/tags.html#IE15" title="Pages tagged IE15" rel="tag">IE15</a>&nbsp;&bull;&nbsp;<a href="/tags.html#teaching" title="Pages tagged teaching" rel="tag">teaching</a>&nbsp;&bull;&nbsp;<a href="/tags.html#week3" title="Pages tagged week3" rel="tag">week3</a></span>
        
          <h3 class="entry-title" itemprop="headline">Week 5:  Maximum Likelihood.</h3>
        
      </header>
            <div class="entry-content" itemprop="description">
        <p>This week we take a look at some numerical issues with maximum likelihood estimation.
  1. We take a look at the effect of the choice of starting value on the outcome of the a BFGS optmization.
  2. We look at the behaviour of the MLE of the parameter of a Bernoulli distribution when the sample size increases. We also look at the behaviour of test statistics.</p>

<h2 id="local-extremum-and-starting-values">Local extremum and starting values.</h2>

<p>First we are going to look at the problems with functions having several local minima, and how the choice of starting value is critical in that case. We consider a function \( f(x) = -cos(x) - exp(-x^2) \) which has a global minimum at 0 and several local minima close to the points when \(x\) is a multiple of \( 2\pi \).</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"># Firs we load some libraries.
library('ggplot2')
library('reshape2')</code></pre></div>

<div class="highlight"><pre><code class="language-r" data-lang="r"># Define the likelihood function:
f &lt;- function(x){ -cos(x)/(1+abs(x)) - exp(-x^2) }

# Generate a set of (x,f(x)) for plotting
x &lt;- seq(-20,20,0.01)
y &lt;- f(x)

# plotting 
xy &lt;- data.frame('x'=x,'y'=y)
gxy &lt;- ggplot(xy,aes(x=x,y=y)) + geom_line() + theme_bw()
print(gxy)</code></pre></div>

<p><img src="/figs/2015-03-03-IE15-W5.rmd/local_ll.png" alt="center" /></p>

<p>We are now going to try to numerically locate the value of \(x\) that minimizes \(f(.)\) for a set of starting values. That is, we try one starting value after another and see where the minimum is found, using a BFGS algorithm.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"># Define a set of starting values. 
par_init &lt;- seq(-20,20,0.5)

# storage
pmat &lt;- matrix(NA,nrow = length(par_init), ncol=2)
pmat[,1] &lt;- par_init
count &lt;- 0

# Looping over the starting values. 
for(par in par_init){
	count &lt;- count + 1
	bf &lt;- optim(par=par,fn=f,method='BFGS')
	pmat[count,2] &lt;- bf$par
	}

# preparing the data
pmat &lt;- cbind(pmat,f(pmat[,1]),f(pmat[,2]))
colnames(pmat) &lt;- c('x_init','x_opt','y_init','y_opt')

mi &lt;- data.frame('x'=pmat[,1],'y'=pmat[,3],'iter'=1:length(par_init))
mi$type &lt;- 'initial'
mo &lt;- data.frame('x'=pmat[,2],'y'=pmat[,4],'iter'=1:length(par_init))
mo$type &lt;- 'optimal'

mp &lt;- rbind(mi,mo)
mp$iter &lt;- as.factor(mp$iter)	
	
#plotting
gp &lt;- ggplot()+ geom_line(data=mp,aes(x=x,y=y,group=iter),colour='gray80') + geom_line(data=xy,aes(x=x,y=y)) + theme_bw() + geom_point(data=mp,aes(x=x,y=y,colour=type),size=3) + scale_x_continuous(limits = c(-20, 20))
print(gp)</code></pre></div>

<p><img src="/figs/2015-03-03-IE15-W5.rmd/local_bfgs.png" alt="center" /></p>

<p>The red-ish dots show the starting values, we try every value from -20 to 20 by steps of 0.5. the blue dots represtent the optimal value returned by BFGS. A grey line connects each inital value to its corresponding optimal value.</p>

<p>There is far fewer blue than red dots, for many starting values the algorithm converges at the same point. The 7 blue dots in the figure correspond to the 6 local minima of the functions (x close to being a multiple of \( 2\pi \)) and the global miminum at \(x=0\).</p>

<p>The most noticeable of the lines joining an initial value to its convergence value are those corresponding to pairs where we start far from the optimal and end up on it or the reverse: inital values close to the optimal value with convergence values far from 0.</p>

<h2 id="mle-and-tests-for-the-parameter-of-a-bernoulli-distribution-with-increasing-sample-size">MLE and tests for the parameter of a Bernoulli distribution with increasing sample size.</h2>

<p>This code is meant to allow you to replicate the plots at the end of the slides of week 5. You will not be able to replicate the exat plots since I forgot to fix the seed when generating them. Rookie mistake.</p>

<p>First we create the function that will compute the LR, Wald, and LM test statistics for \(\mathcal H_0:p=p_0\) given a vector of realisations of the bernoulli random variable and an hypothesis to test.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"># Function to compute the 3 tests.
# Input: the data vector X, the null hypothesis p0
# output: a vector of length 3 with the 3 test statistics
Ltest&lt;-function(X,p0)
{
	iT	&lt;- length(X)
	LR	&lt;-2*((sum(X)*log(mean(X))+(length(X)-sum(X))*log(1-mean(X)))-(sum(X)*log(p0)+(length(X)-sum(X))*log(1-p0)))

	LM	&lt;-(iT^2)*(((mean(X)/p0)-(1-mean(X))/(1-p0))^2)*((p0*(1-p0))/iT)

	W	&lt;-iT*((mean(X)-p0)^2)/(mean(X)*(1-mean(X)))

return(cbind(LR,LM,W))
}</code></pre></div>

<p>Next we create the main loop function. At each iterations the sample is increased by one observation. We estimate \(\hat p \) and its variance and and call the previous function to compute the 3 test statistics. This function then formats the output for plotting.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">bernoulli &lt;- function(p,p0,n){
# Initialization
X	&lt;-NULL
hp	&lt;-NULL
LLtest	&lt;-matrix(NA,nrow=3,ncol=3)
# Estimation with increasing sample. 
for(i in 1:n)
	{
	xi	&lt;-rbinom(1,1,p)	
	X	&lt;-c(X,xi)
	if(i&gt;1)hi	&lt;-cbind(mean(X),mean(X)*(1-mean(X)))
	if(i==1)hi	&lt;-cbind(X,NA)
	hp	&lt;-rbind(hp,hi)
	if(i&gt;3)Lt	&lt;-Ltest(X,p0)
	if(i&gt;3)LLtest	&lt;-rbind(LLtest,Lt)
	}
# formatting
colnames(hp)&lt;-c('p-hat','est var')
mhp&lt;-melt(hp)
# true parameter value and variance.
dfseg&lt;-data.frame(y=c(p,p*(1-p)),Var2=c('p-hat','est var'))
# formatting the test stats
colnames(LLtest)&lt;-c('LR','LM','W')
rownames(LLtest)&lt;-1:n
mLL		&lt;-melt(LLtest)

return(list('mle'=mhp,'trueval'=dfseg,'lltests'=mLL))
}</code></pre></div>

<p>Now we can run an experiment. All we need to do is choose values for \(p,p_0,n\) and plot the output.</p>

<div class="highlight"><pre><code class="language-r" data-lang="r"># Setting the seed
set.seed(06011655)

# True parameter value, null hypothesis and sample size
# Modify these to replicate the different experiments in the slides. 
p	&lt;-0.5
p0	&lt;-0.5
n&lt;-100

# Critical value of the X2 distrib with 1df for 95% tests
X2cv &lt;- qchisq(0.95,1)

# running the XP
xp &lt;- bernoulli(p,p0,n)

#plotting the parameters
gghp&lt;-ggplot(xp$mle,aes(y=value,x=Var1))+facet_grid(Var2~.)+geom_line()+geom_segment(data=xp$trueval,aes(x=0,xend=n,y=y,yend=y),colour='grey')+theme_bw()
print(gghp)</code></pre></div>

<p><img src="/figs/2015-03-03-IE15-W5.rmd/bernoulli.xp.png" alt="center" /></p>

<div class="highlight"><pre><code class="language-r" data-lang="r"># plotting the test stats
ggtest&lt;-ggplot(xp$lltests,aes(y=value,x=Var1,colour=Var2))+geom_line(size=2)+facet_grid(Var2~.,scales='free_y')+geom_segment(size=1.5,x=0,xend=n,y=X2cv,yend=X2cv)+theme_bw()
print(ggtest)</code></pre></div>

<p><img src="/figs/2015-03-03-IE15-W5.rmd/bernoulli.xp.plot.png" alt="center" /></p>


        <div id="disqus_thread"></div><!-- /#disqus_thread -->
      </div><!-- /.entry-content -->
    </div><!-- /.entry-wrapper -->
      </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2015 Laurent Callot. Powered by <a href="http://jekyllrb.com">Jekyll</a> using a <a href=https://github.com/lcallot/lcallot.github.io>home brewed</a> version of the <a href="http://mademistakes.com/">So Simple Theme</a>.</span>
<div class="social-icons">
	
	
	
	
	<a href="http://stackoverflow.com/users/1416977/lcallot" title="Laurent Callot on StackExchange" target="_blank"><i class="icon-stackexchange icon-2x"></i></a>
	
	
	<a href="http://github.com/lcallot" title="Laurent Callot on Github" target="_blank"><i class="icon-github icon-2x"></i></a>
	
</div><!-- /.social-icons -->

  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script src="/assets/js/scripts.min.js"></script>

<!-- Jekyll Simple Search option -->
<script>
  $(document).ready(function() {
      $('.search-field').simpleJekyllSearch({
          jsonFile : '/search.json',
          searchResults : '.search-results',
          template : '<li><article><a href="{url}">{title} <span class="entry-date"><time datetime="{date}">{shortdate}</time></span></a></article></li>',
          noResults: '<p>Nothing found.</p>'
        });
  });

  (function( $, window, undefined ) {
    
     var bs = {
          close: $(".icon-remove-sign"),
          searchform: $(".search-form"),
          canvas: $("body"),
          dothis: $('.dosearch')
      };
    
    bs.dothis.on('click', function() {
      $('.search-wrapper').css({ display: "block" });
      bs.searchform.toggleClass('active');
      bs.searchform.find('input').focus();
      bs.canvas.toggleClass('search-overlay');
    });
    
      bs.close.on('click', function() {
        $('.search-wrapper').removeAttr( 'style' );
        bs.searchform.toggleClass('active');
        bs.canvas.removeClass('search-overlay');
    });
  })( jQuery, window );
</script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl = 
 '//www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-45972660-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'lcallot'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>



	        

</body>
</html>
